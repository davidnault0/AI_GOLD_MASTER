//@version=6
indicator("ğŸ† AI GOLD MASTER", overlay=true, max_lines_count=500, max_boxes_count=500, max_labels_count=500)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ¨ CONFIGURATION GLOBALE / GLOBAL CONFIGURATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Mode de trading
modeGroup = "ğŸ’  MODE & STRATÃ‰GIE"
tradingMode = input.string("Pro", "Mode Trading", options=["Pro", "Agressif"], group=modeGroup)
strategyType = input.string("Swing", "Type StratÃ©gie", options=["Scalping", "Swing", "Intraday"], group=modeGroup)
autoTune = input.bool(true, "Auto-Tune Modules", tooltip="Optimise automatiquement les paramÃ¨tres selon la stratÃ©gie", group=modeGroup)

// ğŸ’° GESTION DU RISQUE / RISK MANAGEMENT
riskGroup = "ğŸ’° GESTION DU RISQUE"
capitalInput = input.float(10000, "Capital ($)", minval=100, group=riskGroup)
riskPercentInput = input.float(2.0, "Risque par Trade (%)", minval=0.1, maxval=10, step=0.1, group=riskGroup)

// ğŸ“ EMAs 50/100/200
emaGroup = "ğŸ“ EMAs 50/100/200"
emaShow = input.bool(true, "VisibilitÃ©", inline="ema1", group=emaGroup)
emaImpact = input.bool(true, "Impact Confluence", inline="ema1", group=emaGroup)
ema50Period = autoTune ? (strategyType == "Scalping" ? 20 : strategyType == "Intraday" ? 50 : 50) : input.int(50, "EMA 50", group=emaGroup)
ema100Period = autoTune ? (strategyType == "Scalping" ? 50 : strategyType == "Intraday" ? 100 : 100) : input.int(100, "EMA 100", group=emaGroup)
ema200Period = autoTune ? (strategyType == "Scalping" ? 100 : strategyType == "Intraday" ? 200 : 200) : input.int(200, "EMA 200", group=emaGroup)

// âš¡ EMA9 MOMENTUM
ema9Group = "âš¡ EMA9 MOMENTUM"
ema9Show = input.bool(true, "VisibilitÃ©", inline="ema9", group=ema9Group)
ema9Impact = input.bool(true, "Impact Confluence", inline="ema9", group=ema9Group)
ema9Period = autoTune ? (strategyType == "Scalping" ? 5 : strategyType == "Intraday" ? 9 : 9) : input.int(9, "PÃ©riode EMA9", group=ema9Group)

// ğŸ“ VWAP
vwapGroup = "ğŸ“ VWAP"
vwapShow = input.bool(true, "VisibilitÃ©", inline="vwap", group=vwapGroup)
vwapImpact = input.bool(true, "Impact Confluence", inline="vwap", group=vwapGroup)

// ğŸ“ˆ SUPERTREND
stGroup = "ğŸ“ˆ SUPERTREND"
stShow = input.bool(true, "VisibilitÃ©", inline="st1", group=stGroup)
stImpact = input.bool(true, "Impact Confluence", inline="st1", group=stGroup)
stPeriod = autoTune ? (strategyType == "Scalping" ? 7 : strategyType == "Intraday" ? 10 : 10) : input.int(10, "PÃ©riode", group=stGroup)
stMultiplier = autoTune ? (strategyType == "Scalping" ? 2.0 : strategyType == "Intraday" ? 3.0 : 3.0) : input.float(3.0, "Multiplicateur", group=stGroup)

// ğŸ“ˆ FIBONACCI AUTO
fiboGroup = "ğŸ“ˆ FIBONACCI AUTO"
fiboShow = input.bool(false, "VisibilitÃ©", tooltip="CachÃ© par dÃ©faut", inline="fibo1", group=fiboGroup)
fiboImpact = input.bool(true, "Impact Confluence", inline="fibo1", group=fiboGroup)
fiboLookback = input.int(50, "Lookback Impulses", minval=10, maxval=200, group=fiboGroup)

// ğŸ”” SQUEEZE
squeezeGroup = "ğŸ”” SQUEEZE"
squeezeShow = input.bool(true, "Afficher Squeeze", group=squeezeGroup)
squeezeBBLength = input.int(20, "BB Length", group=squeezeGroup)
squeezeBBMult = input.float(2.0, "BB Mult", group=squeezeGroup)
squeezeKCLength = input.int(20, "KC Length", group=squeezeGroup)
squeezeKCMult = input.float(1.5, "KC Mult", group=squeezeGroup)

// ğŸŸ¦ DAILY OPEN
dailyGroup = "ğŸŸ¦ DAILY OPEN"
dailyShow = input.bool(true, "VisibilitÃ©", inline="daily1", group=dailyGroup)
dailyImpact = input.bool(false, "Impact Confluence", inline="daily1", group=dailyGroup)

// ğŸ•¯ï¸ ENGULFING
engulfingGroup = "ğŸ•¯ï¸ ENGULFING"
engulfingShow = input.bool(true, "VisibilitÃ©", group=engulfingGroup)
engulfingMinSize = input.float(1.5, "Ratio Min Taille", minval=1.0, maxval=5.0, step=0.1, group=engulfingGroup)

// ğŸ”¹ STRUCTURE HH/HL/LL/LH
structureGroup = "ğŸ”¹ STRUCTURE"
structureShow = input.bool(true, "VisibilitÃ©", group=structureGroup)
structureLookback = input.int(10, "Lookback", minval=5, maxval=50, group=structureGroup)

// ğŸ§± ORDER BLOCKS
obGroup = "ğŸ§± ORDER BLOCKS"
obShow = input.bool(false, "VisibilitÃ©", tooltip="CachÃ© par dÃ©faut", group=obGroup)
obImpact = input.bool(true, "Impact Confluence", group=obGroup)

// ğŸ“ SMC/MSS/BOS
smcGroup = "ğŸ“ SMC/MSS/BOS"
smcShow = input.bool(false, "VisibilitÃ©", tooltip="CachÃ© par dÃ©faut", group=smcGroup)
smcImpact = input.bool(true, "Impact Confluence", group=smcGroup)

// ğŸ’  LIQUIDITY POOLS & EQH/EQL
liqGroup = "ğŸ’  LIQUIDITY POOLS"
liqShow = input.bool(false, "VisibilitÃ©", tooltip="CachÃ© par dÃ©faut", group=liqGroup)
liqImpact = input.bool(true, "Impact Confluence", group=liqGroup)
liqThreshold = input.float(0.2, "Seuil (%)", minval=0.05, maxval=1.0, step=0.05, group=liqGroup)

// ğŸ’ FVG (Fair Value Gaps)
fvgGroup = "ğŸ’ FVG"
fvgShow = input.bool(false, "VisibilitÃ©", tooltip="CachÃ© par dÃ©faut", group=fvgGroup)
fvgImpact = input.bool(true, "Impact Confluence", group=fvgGroup)
fvgMinSize = input.float(0.5, "Taille Min (%)", minval=0.1, maxval=2.0, step=0.1, group=fvgGroup)

// ğŸ“Š ADR/ATR FILTER
atrGroup = "ğŸ“Š ADR/ATR FILTER"
atrShow = input.bool(false, "VisibilitÃ©", tooltip="CachÃ© par dÃ©faut", group=atrGroup)
adrLength = input.int(14, "ADR PÃ©riode", group=atrGroup)
atrLength = input.int(14, "ATR PÃ©riode", group=atrGroup)

// ğŸ“… PDH/PDL/IB + WEEKLY OHLC
pdhGroup = "ğŸ“… PDH/PDL/WEEKLY"
pdhShow = input.bool(false, "VisibilitÃ©", tooltip="CachÃ© par dÃ©faut", group=pdhGroup)
showPDH = input.bool(true, "PDH", inline="pdh1", group=pdhGroup)
showPDL = input.bool(true, "PDL", inline="pdh1", group=pdhGroup)
showPWH = input.bool(true, "PWH", inline="pdh2", group=pdhGroup)
showPWL = input.bool(true, "PWL", inline="pdh2", group=pdhGroup)

// ğŸ“Š VOLUME CONTROL
volGroup = "ğŸ“Š VOLUME CONTROL"
volShow = input.bool(true, "Afficher Volume %", group=volGroup)
volImpact = input.bool(true, "Impact Confluence", group=volGroup)

// ğŸ’  RSI DIVERGENCE MTF
rsiDivGroup = "ğŸ’  RSI DIVERGENCE MTF"
rsiDivShow = input.bool(true, "VisibilitÃ©", group=rsiDivGroup)
rsiDivImpact = input.bool(true, "Impact Confluence", group=rsiDivGroup)
rsiLength = input.int(14, "RSI PÃ©riode", group=rsiDivGroup)
rsiDivLookback = input.int(50, "Lookback", group=rsiDivGroup)

// ğŸ“ˆ TREND LINES AUTO
trendLineGroup = "ğŸ“ˆ TREND LINES AUTO"
trendLineShow = input.bool(false, "VisibilitÃ©", tooltip="CachÃ© par dÃ©faut", group=trendLineGroup)
trendLineImpact = input.bool(true, "Impact Confluence", group=trendLineGroup)

// ğŸš© FLAGS & BREAKOUTS
flagGroup = "ğŸš© FLAGS & BREAKOUTS"
flagShow = input.bool(false, "VisibilitÃ©", tooltip="CachÃ© par dÃ©faut", group=flagGroup)
flagImpact = input.bool(true, "Impact Confluence", group=flagGroup)

// ğŸ¨ STYLE & COULEURS
styleGroup = "ğŸ¨ STYLE & COULEURS"
showDashboard = input.bool(true, "Afficher Dashboard", group=styleGroup)
showSetupLabels = input.bool(true, "Afficher Setup Labels", group=styleGroup)
showCandleColors = input.bool(true, "Bougies Blanches/Noires", tooltip="Haute probabilitÃ© seulement", group=styleGroup)
colorBull = input.color(#00ff00, "Couleur Bull", inline="col1", group=styleGroup)
colorBear = input.color(#ff0000, "Couleur Bear", inline="col1", group=styleGroup)
colorNeutral = input.color(#808080, "Couleur Neutre", inline="col2", group=styleGroup)
colorGold = input.color(#FFD700, "Couleur Or", inline="col2", group=styleGroup)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“Š CALCULS / CALCULATIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// EMAs
ema9 = ta.ema(close, ema9Period)
ema50 = ta.ema(close, ema50Period)
ema100 = ta.ema(close, ema100Period)
ema200 = ta.ema(close, ema200Period)

// EMA Trend
emaTrend = ema50 > ema100 and ema100 > ema200 ? "Bull" : ema50 < ema100 and ema100 < ema200 ? "Bear" : "Neutre"
emaTrendColor = emaTrend == "Bull" ? colorBull : emaTrend == "Bear" ? colorBear : colorNeutral

// EMA9 Momentum
ema9Mom = close > ema9 ? "Bull" : close < ema9 ? "Bear" : "Neutre"
ema9MomColor = ema9Mom == "Bull" ? colorBull : ema9Mom == "Bear" ? colorBear : colorNeutral

// VWAP
vwapValue = ta.vwap(hlc3)
vwapTrend = close > vwapValue ? "Bull" : "Bear"
vwapColor = vwapTrend == "Bull" ? colorBull : colorBear

// Supertrend
[supertrendValue, supertrendDir] = ta.supertrend(stMultiplier, stPeriod)
stTrend = supertrendDir < 0 ? "Bull" : "Bear"
stColor = stTrend == "Bull" ? colorBull : colorBear

// ATR pour calculs
atr = ta.atr(14)

// Daily Open
var float dailyOpen = na
if ta.change(time("D"))
    dailyOpen := open
dailyTrend = close > dailyOpen ? "Bull" : "Bear"
dailyColor = dailyTrend == "Bull" ? colorBull : colorBear

// Squeeze Detection
basis = ta.sma(close, squeezeBBLength)
dev = ta.stdev(close, squeezeBBLength) * squeezeBBMult
upperBB = basis + dev
lowerBB = basis - dev
ma = ta.sma(close, squeezeKCLength)
rangeMA = ta.sma(ta.tr, squeezeKCLength)
rangema = rangeMA * squeezeKCMult
upperKC = ma + rangema
lowerKC = ma - rangema
sqzOn = lowerBB > lowerKC and upperBB < upperKC
sqzOff = lowerBB < lowerKC and upperBB > upperKC
noSqz = not sqzOn and not sqzOff

// Volume Analysis
buyVolume = volume * (close > open ? 1 : 0)
sellVolume = volume * (close <= open ? 1 : 0)
totalVolume = buyVolume + sellVolume
buyPercent = totalVolume > 0 ? (buyVolume / totalVolume) * 100 : 50
sellPercent = totalVolume > 0 ? (sellVolume / totalVolume) * 100 : 50

// RSI
rsi = ta.rsi(close, rsiLength)

// Price vs EMA50
priceVsEma50 = close > ema50 ? "Au-dessus" : "En-dessous"

// ADR/ATR %
smaHigh = ta.sma(high, adrLength)
smaLow = ta.sma(low, adrLength)
adr = smaHigh - smaLow
adrPercent = close > 0 ? (adr / close) * 100 : 0
atrPercent = close > 0 ? (atr / close) * 100 : 0

// Engulfing Detection
isBullishEngulfing = close > open and close[1] < open[1] and close > open[1] and open < close[1] and (close - open) / (high - low) > 0.6 and (close - open) > engulfingMinSize * (open[1] - close[1])
isBearishEngulfing = close < open and close[1] > open[1] and close < open[1] and open > close[1] and (open - close) / (high - low) > 0.6 and (open - close) > engulfingMinSize * (close[1] - open[1])

// Structure Detection (Simplified)
pivotHigh = ta.pivothigh(high, structureLookback, structureLookback)
pivotLow = ta.pivotlow(low, structureLookback, structureLookback)
var float lastHH = na
var float lastHL = na
var float lastLH = na
var float lastLL = na

if not na(pivotHigh)
    if na(lastHH) or pivotHigh > lastHH
        lastHH := pivotHigh
    else if pivotHigh < lastHH
        lastLH := pivotHigh

if not na(pivotLow)
    if na(lastLL) or pivotLow < lastLL
        lastLL := pivotLow
    else if pivotLow > lastLL
        lastHL := pivotLow

// FVG Detection (Simplified)
bullishFVG = low > high[2]
bearishFVG = high < low[2]
fvgSize = bullishFVG ? ((low - high[2]) / close) * 100 : bearishFVG ? ((low[2] - high) / close) * 100 : 0
validBullishFVG = bullishFVG and fvgSize >= fvgMinSize
validBearishFVG = bearishFVG and fvgSize >= fvgMinSize

// Equal Highs/Lows (Liquidity)
eqhThreshold = close * (liqThreshold / 100)
eqlThreshold = close * (liqThreshold / 100)
isEQH = math.abs(high - high[1]) <= eqhThreshold and high >= high[1]
isEQL = math.abs(low - low[1]) <= eqlThreshold and low <= low[1]

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ§  CONFLUENCE ENGINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

confluenceScore = 0
maxConfluence = 0

// EMA Trend
if emaImpact
    maxConfluence += 2
    if emaTrend == "Bull"
        confluenceScore += 2
    else if emaTrend == "Bear"
        confluenceScore -= 2

// EMA9 Momentum
if ema9Impact
    maxConfluence += 1
    if ema9Mom == "Bull"
        confluenceScore += 1
    else if ema9Mom == "Bear"
        confluenceScore -= 1

// VWAP
if vwapImpact
    maxConfluence += 1
    if vwapTrend == "Bull"
        confluenceScore += 1
    else
        confluenceScore -= 1

// Supertrend
if stImpact
    maxConfluence += 2
    if stTrend == "Bull"
        confluenceScore += 2
    else
        confluenceScore -= 2

// RSI
if rsiDivImpact
    maxConfluence += 1
    if rsi < 30
        confluenceScore += 1
    else if rsi > 70
        confluenceScore -= 1

// Volume
if volImpact
    maxConfluence += 1
    if buyPercent > 60
        confluenceScore += 1
    else if sellPercent > 60
        confluenceScore -= 1

// Calculate confluence state
confluenceNormalized = maxConfluence > 0 ? (confluenceScore / maxConfluence) * 100 : 0
confluenceState = confluenceNormalized > 60 ? "BULL FORT" : confluenceNormalized > 20 ? "Bull" : confluenceNormalized < -60 ? "BEAR FORT" : confluenceNormalized < -20 ? "Bear" : "Neutre"
confluenceColor = confluenceNormalized > 60 ? color.new(colorBull, 0) : confluenceNormalized > 20 ? color.new(colorBull, 50) : confluenceNormalized < -60 ? color.new(colorBear, 0) : confluenceNormalized < -20 ? color.new(colorBear, 50) : colorNeutral

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ’° GESTION DU RISQUE / RISK MANAGEMENT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

riskAmount = capitalInput * (riskPercentInput / 100)

// Calcul SL/TP basÃ© sur ATR et mode
atrMultiplierSL = strategyType == "Scalping" ? 1.0 : strategyType == "Intraday" ? 1.5 : 2.0
atrMultiplierTP1 = strategyType == "Scalping" ? 1.5 : strategyType == "Intraday" ? 2.5 : 3.0
atrMultiplierTP2 = strategyType == "Scalping" ? 2.5 : strategyType == "Intraday" ? 4.0 : 5.0
atrMultiplierTP3 = strategyType == "Scalping" ? 4.0 : strategyType == "Intraday" ? 6.0 : 8.0

// Mode agressif augmente les multiplicateurs
if tradingMode == "Agressif"
    atrMultiplierSL *= 0.8
    atrMultiplierTP1 *= 1.2
    atrMultiplierTP2 *= 1.2
    atrMultiplierTP3 *= 1.2

// Setup Long
longEntryPrice = close
longSL = longEntryPrice - (atr * atrMultiplierSL)
longTP1 = longEntryPrice + (atr * atrMultiplierTP1)
longTP2 = longEntryPrice + (atr * atrMultiplierTP2)
longTP3 = longEntryPrice + (atr * atrMultiplierTP3)
longRiskPoints = longEntryPrice - longSL
longRewardPoints = longTP1 - longEntryPrice
longRR = longRiskPoints > 0 ? longRewardPoints / longRiskPoints : 0
longLotSize = longRiskPoints > 0 ? riskAmount / longRiskPoints : 0

// Setup Short
shortEntryPrice = close
shortSL = shortEntryPrice + (atr * atrMultiplierSL)
shortTP1 = shortEntryPrice - (atr * atrMultiplierTP1)
shortTP2 = shortEntryPrice - (atr * atrMultiplierTP2)
shortTP3 = shortEntryPrice - (atr * atrMultiplierTP3)
shortRiskPoints = shortSL - shortEntryPrice
shortRewardPoints = shortEntryPrice - shortTP1
shortRR = shortRiskPoints > 0 ? shortRewardPoints / shortRiskPoints : 0
shortLotSize = shortRiskPoints > 0 ? riskAmount / shortRiskPoints : 0

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“Š MTF BIAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Timeframes pour MTF analysis
tf1 = "1"
tf5 = "5"
tf15 = "15"
tf30 = "30"
tf60 = "60"
tf240 = "240"
tfD = "D"

// Request MTF data
[mtf1Close, mtf1Ema50] = request.security(syminfo.tickerid, tf1, [close, ta.ema(close, 50)], lookahead=barmerge.lookahead_off)
[mtf5Close, mtf5Ema50] = request.security(syminfo.tickerid, tf5, [close, ta.ema(close, 50)], lookahead=barmerge.lookahead_off)
[mtf15Close, mtf15Ema50] = request.security(syminfo.tickerid, tf15, [close, ta.ema(close, 50)], lookahead=barmerge.lookahead_off)
[mtf30Close, mtf30Ema50] = request.security(syminfo.tickerid, tf30, [close, ta.ema(close, 50)], lookahead=barmerge.lookahead_off)
[mtf60Close, mtf60Ema50] = request.security(syminfo.tickerid, tf60, [close, ta.ema(close, 50)], lookahead=barmerge.lookahead_off)
[mtf240Close, mtf240Ema50] = request.security(syminfo.tickerid, tf240, [close, ta.ema(close, 50)], lookahead=barmerge.lookahead_off)
[mtfDClose, mtfDEma50] = request.security(syminfo.tickerid, tfD, [close, ta.ema(close, 50)], lookahead=barmerge.lookahead_off)

// MTF Bias
mtf1Bias = mtf1Close > mtf1Ema50 ? 1 : -1
mtf5Bias = mtf5Close > mtf5Ema50 ? 1 : -1
mtf15Bias = mtf15Close > mtf15Ema50 ? 1 : -1
mtf30Bias = mtf30Close > mtf30Ema50 ? 1 : -1
mtf60Bias = mtf60Close > mtf60Ema50 ? 1 : -1
mtf240Bias = mtf240Close > mtf240Ema50 ? 1 : -1
mtfDBias = mtfDClose > mtfDEma50 ? 1 : -1

// General Bias
genBias = (mtf1Bias + mtf5Bias + mtf15Bias + mtf30Bias + mtf60Bias + mtf240Bias + mtfDBias) / 7
genBiasText = genBias > 0.5 ? "BULL FORT" : genBias > 0.2 ? "Bull" : genBias < -0.5 ? "BEAR FORT" : genBias < -0.2 ? "Bear" : "Neutre"

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ¨ AFFICHAGE / DISPLAY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Plot EMAs
plot(emaShow ? ema50 : na, "EMA 50", color=color.new(#2196F3, 0), linewidth=2)
plot(emaShow ? ema100 : na, "EMA 100", color=color.new(#FF9800, 0), linewidth=2)
plot(emaShow ? ema200 : na, "EMA 200", color=color.new(#9C27B0, 0), linewidth=2)

// Plot EMA9
plot(ema9Show ? ema9 : na, "EMA 9", color=ema9MomColor, linewidth=3)

// Plot VWAP
plot(vwapShow ? vwapValue : na, "VWAP", color=vwapColor, linewidth=2)

// Plot Supertrend
plot(stShow ? supertrendValue : na, "Supertrend", color=stColor, linewidth=2, style=plot.style_line)

// Plot Daily Open
plot(dailyShow and not na(dailyOpen) ? dailyOpen : na, "Daily Open", color=dailyColor, linewidth=2, style=plot.style_circles)

// Engulfing Shapes
plotshape(engulfingShow and isBullishEngulfing, "Bullish Engulfing", shape.triangleup, location.belowbar, color=colorBull, size=size.small)
plotshape(engulfingShow and isBearishEngulfing, "Bearish Engulfing", shape.triangledown, location.abovebar, color=colorBear, size=size.small)

// FVG Boxes
if fvgShow and validBullishFVG
    box.new(bar_index[2], high[2], bar_index, low, border_color=color.new(colorBull, 70), bgcolor=color.new(colorBull, 90))

if fvgShow and validBearishFVG
    box.new(bar_index[2], low[2], bar_index, high, border_color=color.new(colorBear, 70), bgcolor=color.new(colorBear, 90))

// Structure Labels
if structureShow and not na(pivotHigh)
    label.new(bar_index[structureLookback], pivotHigh, "HH", style=label.style_label_down, color=colorBear, textcolor=color.white, size=size.tiny)

if structureShow and not na(pivotLow)
    label.new(bar_index[structureLookback], pivotLow, "LL", style=label.style_label_up, color=colorBull, textcolor=color.white, size=size.tiny)

// Liquidity Markers
plotshape(liqShow and isEQH, "EQH", shape.diamond, location.abovebar, color=color.new(color.purple, 0), size=size.tiny)
plotshape(liqShow and isEQL, "EQL", shape.diamond, location.belowbar, color=color.new(color.purple, 0), size=size.tiny)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ¯ SETUP DETECTION & SIGNAUX
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Conditions pour setup Long
longCondition = confluenceNormalized > 40 and stTrend == "Bull" and close > ema9 and close > vwapValue
// Conditions pour setup Short
shortCondition = confluenceNormalized < -40 and stTrend == "Bear" and close < ema9 and close < vwapValue

// Candlestick coloring (haute probabilitÃ© seulement)
strongBullCondition = confluenceNormalized > 70 and longCondition and isBullishEngulfing
strongBearCondition = confluenceNormalized < -70 and shortCondition and isBearishEngulfing

candleColor = showCandleColors and strongBullCondition ? color.white : showCandleColors and strongBearCondition ? color.black : na
barcolor(candleColor)

// Setup Labels sur le graphique
if showSetupLabels and longCondition and ta.change(longCondition)
    labelText = "ğŸš€ LONG\n" + 
                 "Entry: " + str.tostring(longEntryPrice, format.mintick) + "\n" +
                 "SL: " + str.tostring(longSL, format.mintick) + "\n" +
                 "TP1: " + str.tostring(longTP1, format.mintick) + "\n" +
                 "RR: " + str.tostring(longRR, "#.##") + "\n" +
                 "Lot: " + str.tostring(longLotSize, "#.##")
    label.new(bar_index, low, labelText, style=label.style_label_up, color=color.new(colorBull, 20), textcolor=color.white, size=size.normal)

if showSetupLabels and shortCondition and ta.change(shortCondition)
    labelText = "ğŸ”» SHORT\n" + 
                 "Entry: " + str.tostring(shortEntryPrice, format.mintick) + "\n" +
                 "SL: " + str.tostring(shortSL, format.mintick) + "\n" +
                 "TP1: " + str.tostring(shortTP1, format.mintick) + "\n" +
                 "RR: " + str.tostring(shortRR, "#.##") + "\n" +
                 "Lot: " + str.tostring(shortLotSize, "#.##")
    label.new(bar_index, high, labelText, style=label.style_label_down, color=color.new(colorBear, 20), textcolor=color.white, size=size.normal)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“Š DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

if showDashboard and barstate.islast
    var table dashboard = table.new(position.bottom_left, 2, 16, border_width=2, border_color=colorGold, frame_color=colorGold, frame_width=2)
    
    // Row 1: Titre et Prix
    table.cell(dashboard, 0, 0, "ğŸ† AI GOLD MASTER", text_color=colorGold, bgcolor=color.black, text_size=size.large)
    table.cell(dashboard, 1, 0, str.tostring(close, format.mintick), text_color=color.white, bgcolor=color.black, text_size=size.large)
    
    // Row 2: Mode
    modeText = tradingMode + " | " + strategyType
    table.cell(dashboard, 0, 1, "Mode", text_color=colorGold, bgcolor=color.black)
    table.cell(dashboard, 1, 1, modeText, text_color=color.white, bgcolor=color.black)
    
    // Row 3: Tendance
    table.cell(dashboard, 0, 2, "Tendance", text_color=colorGold, bgcolor=color.black)
    table.cell(dashboard, 1, 2, emaTrend, text_color=emaTrendColor, bgcolor=color.black)
    
    // Row 4: Confluence
    confluenceDisplayScore = str.tostring(math.round(confluenceNormalized), "#")
    table.cell(dashboard, 0, 3, "Confluence", text_color=colorGold, bgcolor=color.black)
    table.cell(dashboard, 1, 3, confluenceState + " (" + confluenceDisplayScore + "%)", text_color=confluenceColor, bgcolor=color.black)
    
    // Row 5: Volume
    volumeText = "Buy: " + str.tostring(math.round(buyPercent), "#") + "% | Sell: " + str.tostring(math.round(sellPercent), "#") + "%"
    table.cell(dashboard, 0, 4, "Volume", text_color=colorGold, bgcolor=color.black)
    table.cell(dashboard, 1, 4, volumeText, text_color=buyPercent > 50 ? colorBull : colorBear, bgcolor=color.black)
    
    // Row 6: EMA Trend
    table.cell(dashboard, 0, 5, "EMA Trend", text_color=colorGold, bgcolor=color.black)
    table.cell(dashboard, 1, 5, emaTrend, text_color=emaTrendColor, bgcolor=color.black)
    
    // Row 7: EMA9 Momentum
    table.cell(dashboard, 0, 6, "EMA9 MoM", text_color=colorGold, bgcolor=color.black)
    table.cell(dashboard, 1, 6, ema9Mom, text_color=ema9MomColor, bgcolor=color.black)
    
    // Row 8: VWAP
    table.cell(dashboard, 0, 7, "VWAP", text_color=colorGold, bgcolor=color.black)
    table.cell(dashboard, 1, 7, vwapTrend, text_color=vwapColor, bgcolor=color.black)
    
    // Row 9: Supertrend
    table.cell(dashboard, 0, 8, "Supertrend", text_color=colorGold, bgcolor=color.black)
    table.cell(dashboard, 1, 8, stTrend, text_color=stColor, bgcolor=color.black)
    
    // Row 10: Daily Open
    table.cell(dashboard, 0, 9, "Daily Open", text_color=colorGold, bgcolor=color.black)
    table.cell(dashboard, 1, 9, dailyTrend, text_color=dailyColor, bgcolor=color.black)
    
    // Row 11: Prix vs EMA50
    table.cell(dashboard, 0, 10, "Prix vs EMA50", text_color=colorGold, bgcolor=color.black)
    table.cell(dashboard, 1, 10, priceVsEma50, text_color=close > ema50 ? colorBull : colorBear, bgcolor=color.black)
    
    // Row 12: SL & TP
    currentSetup = confluenceScore > 0 ? "Long" : "Short"
    currentSL = confluenceScore > 0 ? longSL : shortSL
    currentTP = confluenceScore > 0 ? longTP1 : shortTP1
    slTpText = "SL: " + str.tostring(currentSL, format.mintick) + " | TP: " + str.tostring(currentTP, format.mintick)
    table.cell(dashboard, 0, 11, "SL & TP", text_color=colorGold, bgcolor=color.black)
    table.cell(dashboard, 1, 11, slTpText, text_color=color.white, bgcolor=color.black)
    
    // Row 13: RR & LOT
    currentRR = confluenceScore > 0 ? longRR : shortRR
    currentLot = confluenceScore > 0 ? longLotSize : shortLotSize
    rrLotText = "RR: " + str.tostring(currentRR, "#.##") + " | Lot: " + str.tostring(currentLot, "#.##")
    table.cell(dashboard, 0, 12, "RR & LOT", text_color=colorGold, bgcolor=color.black)
    table.cell(dashboard, 1, 12, rrLotText, text_color=color.white, bgcolor=color.black)
    
    // Row 14: SYM/TF
    symTfText = syminfo.ticker + " / " + timeframe.period
    table.cell(dashboard, 0, 13, "SYM/TF", text_color=colorGold, bgcolor=color.black)
    table.cell(dashboard, 1, 13, symTfText, text_color=color.white, bgcolor=color.black)
    
    // Row 15: Squeeze
    squeezeText = sqzOn ? "SQUEEZE ğŸŸ¡" : "NO SQUEEZE"
    squeezeColor = sqzOn ? color.yellow : color.gray
    table.cell(dashboard, 0, 14, "Squeeze", text_color=colorGold, bgcolor=color.black)
    table.cell(dashboard, 1, 14, squeezeText, text_color=squeezeColor, bgcolor=color.black)
    
    // Row 16: MTF Bias General
    table.cell(dashboard, 0, 15, "GEN Bias", text_color=colorGold, bgcolor=color.black)
    table.cell(dashboard, 1, 15, genBiasText, text_color=genBias > 0 ? colorBull : genBias < 0 ? colorBear : colorNeutral, bgcolor=color.black)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“Š MTF BIAS DASHBOARD (Right Side)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

if showDashboard and barstate.islast
    var table mtfDashboard = table.new(position.bottom_right, 2, 8, border_width=2, border_color=colorGold, frame_color=colorGold, frame_width=2)
    
    // Header
    table.cell(mtfDashboard, 0, 0, "TF", text_color=colorGold, bgcolor=color.black, text_size=size.normal)
    table.cell(mtfDashboard, 1, 0, "BIAS", text_color=colorGold, bgcolor=color.black, text_size=size.normal)
    
    // 1m
    table.cell(mtfDashboard, 0, 1, "1m", text_color=color.white, bgcolor=color.black)
    table.cell(mtfDashboard, 1, 1, mtf1Bias > 0 ? "ğŸŸ¢" : "ğŸ”´", text_color=color.white, bgcolor=color.black)
    
    // 5m
    table.cell(mtfDashboard, 0, 2, "5m", text_color=color.white, bgcolor=color.black)
    table.cell(mtfDashboard, 1, 2, mtf5Bias > 0 ? "ğŸŸ¢" : "ğŸ”´", text_color=color.white, bgcolor=color.black)
    
    // 15m
    table.cell(mtfDashboard, 0, 3, "15m", text_color=color.white, bgcolor=color.black)
    table.cell(mtfDashboard, 1, 3, mtf15Bias > 0 ? "ğŸŸ¢" : "ğŸ”´", text_color=color.white, bgcolor=color.black)
    
    // 30m
    table.cell(mtfDashboard, 0, 4, "30m", text_color=color.white, bgcolor=color.black)
    table.cell(mtfDashboard, 1, 4, mtf30Bias > 0 ? "ğŸŸ¢" : "ğŸ”´", text_color=color.white, bgcolor=color.black)
    
    // 1H
    table.cell(mtfDashboard, 0, 5, "1H", text_color=color.white, bgcolor=color.black)
    table.cell(mtfDashboard, 1, 5, mtf60Bias > 0 ? "ğŸŸ¢" : "ğŸ”´", text_color=color.white, bgcolor=color.black)
    
    // 4H
    table.cell(mtfDashboard, 0, 6, "4H", text_color=color.white, bgcolor=color.black)
    table.cell(mtfDashboard, 1, 6, mtf240Bias > 0 ? "ğŸŸ¢" : "ğŸ”´", text_color=color.white, bgcolor=color.black)
    
    // Daily
    table.cell(mtfDashboard, 0, 7, "D", text_color=color.white, bgcolor=color.black)
    table.cell(mtfDashboard, 1, 7, mtfDBias > 0 ? "ğŸŸ¢" : "ğŸ”´", text_color=color.white, bgcolor=color.black)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ¯ ALERTES / ALERTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alertcondition(longCondition, title="Long Setup", message="ğŸš€ Setup LONG dÃ©tectÃ© - Confluence: {{plot_0}}%")
alertcondition(shortCondition, title="Short Setup", message="ğŸ”» Setup SHORT dÃ©tectÃ© - Confluence: {{plot_0}}%")
alertcondition(sqzOn, title="Squeeze ActivÃ©", message="ğŸŸ¡ SQUEEZE dÃ©tectÃ© - Compression en cours")
alertcondition(isBullishEngulfing, title="Bullish Engulfing", message="ğŸ“ˆ Bougie englobante haussiÃ¨re dÃ©tectÃ©e")
alertcondition(isBearishEngulfing, title="Bearish Engulfing", message="ğŸ“‰ Bougie englobante baissiÃ¨re dÃ©tectÃ©e")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ‰ FIN DU CODE / END OF CODE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
